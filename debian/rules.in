#!/usr/bin/make -f

i=$(shell pwd)/debian/tmp
b=$(shell pwd)/debian/build

configure: configure.in
	@echo "--- Making configure script and configuring"
	chmod +x autogen.sh
	./autogen.sh --prefix=/@PREFIX@ --with-gtk-prefix=/@GTKPREFIX@ --bindir=/@BINDIR@ --localstatedir=/@LOCALSTATEDIR@

Makefile: configure
	@echo "--- Configuring"
	chmod +x configure
	./configure --prefix=/@PREFIX@ --with-gtk-prefix=/@GTKPREFIX@ --bindir=/@BINDIR@ --localstatedir=/@LOCALSTATEDIR@

build: configure Makefile build-debstamp
build-debstamp:
	@echo "--- Compiling"
	dh_testdir
	$(MAKE) all
	touch build-debstamp

clean: configure Makefile
	@echo "--- Cleaning"
	dh_testdir
	-rm -rf static shared
	-rm -f build-debstamp install-debstamp
	-make distclean
	-rm -f `find . -name "*~"`
	-rm -rf `find . -name "\.deps"`
	-rm -rf `find . -name "\.libs"`
	-rm -rf `find . -name "*\.rej"`
	-rm -rf debian/tmp `find debian/* -type d ! -name CVS` debian/files* core
	-rm -f debian/*substvars

install: build install-debstamp
install-debstamp:
	@echo "--- Installing"
	dh_testdir
	dh_testroot
	dh_clean
	rm -rf $(b)
	$(MAKE) install prefix=$(i)/@PREFIX@ exec_prefix=$(i)/@PREFIX@ bindir=$(i)/@BINDIR@ localstatedir=$(i)/@LOCALSTATEDIR@
	touch install-debstamp

install-save: install
	rm -rf $(i).saved
	cp -a $(i) $(i).saved

install-saved:
	rm -rf $(i)
	cp -a $(i).saved $(i)
	rm -rf $(b)
	touch install-debstamp

binary-indep: build install \
		gnome-games@SUFFIX@

binary-arch: build install \
		gnome-card-games@SUFFIX@ \
		gnome-gnomine@SUFFIX@ \
		gnome-mahjongg@SUFFIX@ \
		gnome-same-gnome@SUFFIX@ \
		gnome-scottfree@SUFFIX@ \
		gnome-gyahtzee@SUFFIX@ \
		gnome-gnobots@SUFFIX@ \
		gnome-gnothello@SUFFIX@

#
# gnome-games
#

gnome-games@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					README NEWS AUTHORS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@ 
	dh_fixperms          -p$@ -P$(b)/$@ 
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-card-games
#

gnome-card-games@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					README NEWS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					ChangeLog
	cp aisleriot/RULES \
	    $(b)/$@/usr/doc/$@/RULES.aisleriot
	cp aisleriot/TODO \
	    $(b)/$@/usr/doc/$@/TODO.aisleriot
	cp aisleriot/AUTHORS \
	    $(b)/$@/usr/doc/$@/AUTHORS.aisleriot
	cp freecell/TODO \
	    $(b)/$@/usr/doc/$@/TODO.freecell
	cp freecell/AUTHORS \
	    $(b)/$@/usr/doc/$@/AUTHORS.freecell
	cp aisleriot/ChangeLog \
	    $(b)/$@/usr/doc/$@/changelog.aisleriot
	cp freecell/ChangeLog \
	    $(b)/$@/usr/doc/$@/changelog.freecell
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@ 
	dh_fixperms          -p$@ -P$(b)/$@ 
	dh_installmenu       -p$@ -P$(b)/$@
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				sol.1 freecell.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-gnomine
#

gnome-gnomine@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					NEWS gnomine/README \
					gnomine/AUTHORS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					gnomine/ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@ 
	mkdir -p $(b)/$@/@LOCALSTATEDIR@/games
	dh_fixperms          -p$@ -P$(b)/$@ 
	chown root.games $(b)/$@/@BINDIR@/*
	chmod 2775 $(b)/$@/@BINDIR@/*
	dh_suidregister	     -p$@ -P$(b)/$@
	dh_installmenu       -p$@ -P$(b)/$@
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				gnomine.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-mahjongg
#

gnome-mahjongg@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					mahjongg/README mahjongg/NEWS \
					mahjongg/TODO AUTHORS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					mahjongg/ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@
	mkdir -p $(b)/$@/@LOCALSTATEDIR@/games
	dh_fixperms          -p$@ -P$(b)/$@ 
	chown root.games $(b)/$@/@BINDIR@/*
	chmod 2775 $(b)/$@/@BINDIR@/*
	dh_suidregister	     -p$@ -P$(b)/$@
	dh_installmenu       -p$@ -P$(b)/$@
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				mahjongg.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-same-gnome
#

gnome-same-gnome@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					same-gnome/README same-gnome/NEWS \
					same-gnome/TODO AUTHORS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					same-gnome/ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@ 
	mkdir -p $(b)/$@/@LOCALSTATEDIR@/games
	dh_fixperms          -p$@ -P$(b)/$@ 
	chown root.games $(b)/$@/@BINDIR@/*
	chmod 2775 $(b)/$@/@BINDIR@/*
	dh_suidregister	     -p$@ -P$(b)/$@
	dh_installmenu       -p$@ -P$(b)/$@
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				same-gnome.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-scottfree
#

gnome-scottfree@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					scottfree/README scottfree/AUTHORS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					scottfree/ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@ 
	dh_fixperms          -p$@ -P$(b)/$@ 
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				GnomeScott.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-gyahtzee
#

gnome-gyahtzee@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					gyahtzee/README \
					gyahtzee/TODO gyahtzee/AUTHORS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					gyahtzee/ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@
	mkdir -p $(b)/$@/@LOCALSTATEDIR@/games
	dh_fixperms          -p$@ -P$(b)/$@ 
	chown root.games $(b)/$@/@BINDIR@/*
	chmod 2775 $(b)/$@/@BINDIR@/*
	dh_suidregister	     -p$@ -P$(b)/$@
	dh_installmenu       -p$@ -P$(b)/$@
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				gyahtzee.1 cyahtzee.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-gnobots
#

gnome-gnobots@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					gnobots/README \
					gnobots/AUTHORS \
					gnobots/index.html
	dh_installchangelogs -p$@ -P$(b)/$@ \
					gnobots/ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@
	mkdir -p $(b)/$@/@LOCALSTATEDIR@/games
	dh_fixperms          -p$@ -P$(b)/$@ 
	chown root.games $(b)/$@/@BINDIR@/*
	chmod 2775 $(b)/$@/@BINDIR@/*
	dh_suidregister	     -p$@ -P$(b)/$@
	dh_installmenu       -p$@ -P$(b)/$@
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				gnobots.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@

#
# gnome-gnothello
#

gnome-gnothello@SUFFIX@: install
	@echo "--- Building: $@"
	dh_installdocs       -p$@ -P$(b)/$@ \
					gnothello/AUTHORS
	dh_installchangelogs -p$@ -P$(b)/$@ \
					ChangeLog
	dh_movefiles         -p$@ -P$(b)/$@
	dh_strip             -p$@ -P$(b)/$@ 
	dh_compress          -p$@ -P$(b)/$@
	dh_fixperms          -p$@ -P$(b)/$@ 
	dh_suidregister	     -p$@ -P$(b)/$@
	dh_installmenu       -p$@ -P$(b)/$@
	dh_installdeb        -p$@ -P$(b)/$@
	dh_shlibdeps         -p$@ -P$(b)/$@
	dh_gencontrol        -p$@ -P$(b)/$@
	dh_makeshlibs        -p$@ -P$(b)/$@
	dh_undocumented      -p$@ -P$(b)/$@ \
				gnothello.1
	dh_md5sums           -p$@ -P$(b)/$@
	dh_builddeb          -p$@ -P$(b)/$@


binary: binary-indep binary-arch
.PHONY: binary clean binary-indep binary-arch build install install-save install-saved


